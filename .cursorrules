# Kenya Track and Trace System - Cursor AI Rules

## ðŸš¨ CRITICAL: Database & TypeORM Naming Standard

**Decision Date:** December 11, 2025  
**Status:** âœ… FINAL - No migration planned for legacy tables  
**Reference:** FINAL_RECOMMENDATION_CAMEL_VS_SNAKE.md

---

## ðŸ“‹ THE STANDARD (Read This First!)

### For **NEW** Tables & Entities

**Database Columns:** snake_case (PostgreSQL standard)  
**Entity Properties:** camelCase (JavaScript/API standard)  
**Mapping:** Use `@Column({ name: '...' })` to bridge them

**Example:**
```typescript
// Database: snake_case columns
CREATE TABLE product_audits (
  id SERIAL PRIMARY KEY,
  user_id UUID,
  created_at TIMESTAMP
);

// Entity: camelCase properties + overrides
@Entity('product_audits')
export class ProductAudit {
  @Column({ name: 'user_id' })
  userId: string;  // API: { "userId": "..." }
  
  @Column({ name: 'created_at' })
  createdAt: Date;  // API: { "createdAt": "..." }
}
```

### For **LEGACY** Tables (users, batches, consignments)

**Database:** camelCase columns (keep as-is)  
**Entities:** camelCase properties (no overrides)  
**Status:** No migration

---

## ðŸŽ¯ Rules for NEW Development

### 1. Database (SQL) - Use snake_case

```sql
CREATE TABLE new_feature (
  user_id UUID NOT NULL,
  product_id INTEGER,
  is_enabled BOOLEAN,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 2. Entities - Use camelCase + Overrides

```typescript
@Entity('new_feature')
export class NewFeature {
  @Column({ name: 'user_id' })
  userId: string;
  
  @Column({ name: 'product_id' })
  productId: number;
  
  @Column({ name: 'is_enabled' })
  isEnabled: boolean;
  
  @Column({ name: 'created_at' })
  createdAt: Date;
}
```

### 3. Why This Pattern?

- âœ… PostgreSQL-friendly DB (snake_case)
- âœ… JavaScript-friendly API (camelCase)
- âœ… No serialization layer needed
- âœ… Frontend compatibility

**Gold Standard:** `epcis-event.entity.ts`, `facility-inventory.entity.ts`

---

## ðŸ“š Reference Examples

**Follow These (Modern):**
- epcis-event.entity.ts
- facility-inventory.entity.ts  
- product-status.entity.ts

**Don't Copy (Legacy):**
- user.entity.ts (camelCase DB)
- batch.entity.ts (camelCase DB)

---

## âœ… Before Creating New Tables

1. Check schema: `\d tablename`
2. Follow EPCIS pattern
3. Use snake_case SQL + camelCase entities

---

**Last Updated**: December 11, 2025  
**Reference**: FINAL_RECOMMENDATION_CAMEL_VS_SNAKE.md

# ====================================================================================
# DOCUMENTATION REFERENCE RULES (Added: Dec 11, 2025)
# ====================================================================================

## Primary Documentation Index
**ALWAYS START HERE**: DOCUMENTATION_INDEX.md
- This is the single source of truth for all documentation
- Lists ONLY current/active documentation
- Updated after each major change

## Documentation Organization

### Current/Active Documentation (Use ONLY These)
**Root Directory**:
- README.md - Project overview
- ARCHITECTURE.md - System architecture (LATEST)
- DATA_PERSISTENCE_ANALYSIS.md - Consolidated data analysis (LATEST, Dec 11)
- PARTIES_OBJECT_PERSISTENCE_AUDIT.md - Parties JSON field mapping
- README_IMPLEMENTATION_STATUS.md - Current implementation status
- DOCUMENTATION_INDEX.md - Documentation navigation (START HERE)

**Organized Directories**:
- docs/architecture/ - Architecture decisions
- docs/data-model/ - Database schemas
- docs/implementation/ - Implementation guides
- docs/testing/ - Test documentation
- test-data/ - Test JSON files with README

### Deprecated/Archived (NEVER Reference)
**IGNORE**:
- docs/archive/ - Old documentation (historical reference only)
- test-data/archive/ - Old test files
- Any file with version suffix (V1, V2, FINAL, PROPER, OLD, etc.)

## Test Data Rules

**PRIMARY TEST FILE**: test-data/TEST_QUICK_DEMO.json
- Use this for standard consignment import testing
- Do NOT create DEMO_V1, DEMO_V2, DEMO_FINAL variations
- Use git for versioning, NOT filename suffixes

**Test File Naming**: `{PURPOSE}_{PRODUCT}_{OPTIONAL_VARIANT}.json`
- Good: TEST_QUICK_DEMO.json, TEST_VACCINE_BATCH.json
- Bad: DEMO_FINAL.json, DEMO_PROPER.json, TEST_V2.json

## Documentation Lifecycle

### When Creating New Docs:
1. Add to appropriate docs/ subdirectory
2. Update DOCUMENTATION_INDEX.md
3. Add "Last Updated: YYYY-MM-DD" in file header

### When Updating Docs:
1. Update file in-place (git tracks changes)
2. Update "Last Updated" date in header
3. If major rewrite: Archive old version to docs/archive/ with date suffix

### When Document Becomes Outdated:
```bash
mv OLD_DOC.md docs/archive/OLD_DOC_YYYY-MM-DD.md
# Update DOCUMENTATION_INDEX.md to remove reference
```

## Database Schema Reference

**LATEST DATABASE SCHEMA**: After migrations V02, V03, V05
- Consignments: 38 fields (includes ALL party fields)
- Batches: 15 fields (includes manufacturing metadata)
- Parties: 4 normalized tables (parties, locations, consignment_parties, consignment_locations)

**Migration Files**: kenya-tnt-system/database/migrations/
- V02: ILMD support, clinical tables
- V03: Party normalization, ppb_batches cleanup
- V04: Product manufacturers, addresses (pending)
- V05: Complete parties object fields

## AI Agent Rules

**When asked about documentation**:
1. Check DOCUMENTATION_INDEX.md first
2. Reference ONLY files listed in index
3. Ignore files in docs/archive/
4. For data model: Use DATA_PERSISTENCE_ANALYSIS.md (Dec 11, 2025)
5. For testing: Use test-data/TEST_QUICK_DEMO.json

**When asked about database schema**:
1. Check applied migrations in kenya-tnt-system/database/migrations/
2. Verify actual schema: `docker-compose exec postgres psql -U tnt_user -d kenya_tnt_db -c "\d tablename"`
3. Reference DATA_PERSISTENCE_ANALYSIS.md for complete field mapping

**When confused by multiple files**:
1. Look for "Last Updated" date in file header
2. Prefer files with recent dates
3. Check DOCUMENTATION_INDEX.md for canonical reference

---

**Last Updated**: December 11, 2025
**Purpose**: Prevent documentation confusion and ensure AI references latest files only
